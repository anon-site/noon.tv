# ANON TV - Apache Configuration
# Ensure proper PWA functionality
# Support both HTTP and HTTPS

# Enable CORS for PWA (HTTP and HTTPS)
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
Header always set Access-Control-Allow-Credentials "true"

# Cache control for PWA files
<FilesMatch "\.(manifest|json)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Service Worker cache control
<FilesMatch "sw\.js$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Static assets cache control
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000"
</FilesMatch>

# HTML files cache control
<FilesMatch "\.html$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Allow HTTP and HTTPS protocols
RewriteEngine On

# Remove HSTS header to allow HTTP
Header unset Strict-Transport-Security

# Redirect root to TV-AR if accessing from PWA
RewriteCond %{HTTP_USER_AGENT} ".*Mobile.*" [NC]
RewriteCond %{QUERY_STRING} "source=pwa"
RewriteRule ^$ /TV-AR/ [R=301,L]

# Ensure proper MIME types
AddType application/manifest+json .webmanifest
AddType application/json .json
AddType text/javascript .js
AddType text/css .css
